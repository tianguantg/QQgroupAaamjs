<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾¤èŠå½©è›‹ - AAaç¾ç”²å¸ˆåæ´ä¼š</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .easter-egg-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: var(--spacing-lg);
        }
        
        .easter-egg-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: var(--spacing-xl);
            max-width: 800px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            animation: cardFloat 6s ease-in-out infinite;
        }
        
        .easter-egg-title {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            margin: 0 0 var(--spacing-lg) 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleGlow 3s ease-in-out infinite alternate;
        }
        
        .easter-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }
        
        .easter-stat-item {
            text-align: center;
            padding: var(--spacing-md);
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        
        .easter-stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--color-primary);
            animation: numberPulse 2s ease-in-out infinite;
        }
        
        .easter-stat-label {
            color: var(--color-text-secondary);
            font-size: var(--font-size-sm);
            margin-top: var(--spacing-xs);
        }
        
        .easter-chart-container {
            height: 300px;
            margin: var(--spacing-lg) 0;
            background: rgba(255, 255, 255, 0.8);
            border-radius: var(--border-radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.9);
        }
        
        @keyframes cardFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes titleGlow {
            0% { text-shadow: 0 0 20px rgba(102, 126, 234, 0.5); }
            100% { text-shadow: 0 0 30px rgba(118, 75, 162, 0.8); }
        }
        
        @keyframes numberPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
    <script src="echarts.min.js"></script>
</head>
<body>
    <div class="easter-egg-container">
    <div class="card easter-egg-card">
      <h1 class="easter-egg-title">è¿™æ˜¯ä¸€ä¸ªéšæœºçš„å½©è›‹å¡ç‰‡</h1>
      
      <div class="stat-content" id="statContent">
        <div class="stat-type">åŠ è½½ä¸­...</div>
        <div class="stat-main"></div>
        <div class="stat-detail">æ­£åœ¨è·å–éšæœºç»Ÿè®¡æ•°æ®</div>
      </div>
      
      <a href="index.html" class="back-link">â—€ è¿”å›ä¸»é¡µ</a>
    </div>
  </div>

    <script>
        let basicStats = null;
        let currentStatIndex = -1;
        
        // ç»Ÿè®¡ä¿¡æ¯é…ç½®
        const statConfigs = [
            {
                key: 'total_messages',
                type: 'ç¾¤èŠæ´»è·ƒåº¦',
                getValue: (stats) => stats.total_messages?.toLocaleString() || 'æœªçŸ¥',
                getDetail: (stats) => 'ç¾¤èŠå†å²æ€»æ¶ˆæ¯æ•°é‡'
            },
            {
                key: 'top_user',
                type: 'å¹´åº¦æœ€é«˜é¢‘å‘è¨€è´¡çŒ®å¥–',
                getValue: (stats) => stats.top_user?.name || 'æœªçŸ¥ç”¨æˆ·',
                getDetail: (stats) => `å‘é€äº† ${stats.top_user?.message_count?.toLocaleString() || 0} æ¡æ¶ˆæ¯`
            },
            {
                key: 'top_mention_user',
                type: 'å¹´åº¦æœ€ä½³@å¥–',
                getValue: (stats) => stats.top_mention_user?.name || 'æœªçŸ¥ç”¨æˆ·',
                getDetail: (stats) => `@äº†ä»–äºº ${stats.top_mention_user?.mention_count?.toLocaleString() || 0} æ¬¡`
            },
            {
                key: 'top_mentioned_user',
                type: 'å¹´åº¦æœ€å—@ç„¦ç‚¹äººç‰©',
                getValue: (stats) => stats.top_mentioned_user?.name || 'æœªçŸ¥ç”¨æˆ·',
                getDetail: (stats) => `è¢«@äº† ${stats.top_mentioned_user?.mentioned_count?.toLocaleString() || 0} æ¬¡`
            },
            {
                key: 'top_poked_user',
                type: 'å¹´åº¦æœ€å—"æˆ³ä¸€æˆ³"å¯¹è±¡',
                getValue: (stats) => stats.top_poked_user?.name || 'æœªçŸ¥ç”¨æˆ·',
                getDetail: (stats) => `è¢«æˆ³äº† ${stats.top_poked_user?.poked_count?.toLocaleString() || 0} æ¬¡`
            },
            {
                key: 'top_closeness_pair',
                type: 'å¹´åº¦æœ€ä½³ç»„åˆ',
                getValue: (stats) => {
                    const pair = stats.top_closeness_pair;
                    if (pair?.user_a && pair?.user_b) {
                        return `${pair.user_a} <br>&<br> ${pair.user_b}`;
                    }
                    return 'æœªçŸ¥ç»„åˆ';
                },
                getDetail: (stats) => {
                    const index = stats.top_closeness_pair?.closeness_index;
                    return index ? `äº²å¯†åº¦æŒ‡æ•°: ${Math.round(index * 100)}%` : 'äº²å¯†åº¦æœªçŸ¥';
                }
            },
            {
                key: 'active_hours',
                type: '24å°æ—¶æ´»è·ƒåº¦åˆ†æ',
                getValue: (stats) => 'æ´»è·ƒæ—¶é—´åˆ†å¸ƒå›¾',
                getDetail: (stats) => {
                    const hourlyData = stats.active_hours?.hourly || [];
                    const maxHour = hourlyData.reduce((max, curr) => 
                        curr.count > max.count ? curr : max, {hour: 0, count: 0});
                    return `æœ€æ´»è·ƒæ—¶æ®µ: ${maxHour.hour}:00 (${maxHour.count?.toLocaleString() || 0} æ¡æ¶ˆæ¯)`;
                },
                isChart: true
            }
        ];

        async function loadBasicStats() {
            try {
                const response = await fetch(`assets/data/global_data/global_data.json?t=${Date.now()}`);
                if (!response.ok) throw new Error('æ•°æ®åŠ è½½å¤±è´¥');
                const data = await response.json();
                basicStats = data.basic_stats;
                return true;
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                return false;
            }
        }

        function getRandomStatIndex() {
            let newIndex;
            do {
                newIndex = Math.floor(Math.random() * statConfigs.length);
            } while (newIndex === currentStatIndex && statConfigs.length > 1);
            return newIndex;
        }

        function displayStat(statIndex) {
            if (!basicStats || statIndex < 0 || statIndex >= statConfigs.length) {
                displayError();
                return;
            }

            const config = statConfigs[statIndex];
            const statContent = document.getElementById('statContent');
            
            // æ·»åŠ åŠ è½½åŠ¨ç”»
            statContent.classList.add('loading');
            
            setTimeout(() => {
                const value = config.getValue(basicStats);
                const detail = config.getDetail(basicStats);
                
                if (config.isChart) {
                    // æ˜¾ç¤ºå›¾è¡¨
                    statContent.innerHTML = `
                        <div class="stat-type">${config.type}</div>
                        <div class="chart-container">
                            <canvas class="chart-canvas" id="activityChart"></canvas>
                        </div>
                        <div class="stat-detail">${detail}</div>
                    `;
                    
                    // ç»˜åˆ¶24å°æ—¶æ´»è·ƒåº¦æŠ˜çº¿å›¾
                    setTimeout(() => drawActivityChart(), 100);
                } else {
                    // å¤„ç†ç”¨æˆ·åé«˜äº®
                    const highlightedValue = value.includes('&') 
                        ? value.split(' & ').map(name => `<span class="user-highlight">${name}</span>`).join(' & ')
                        : (config.key !== 'total_messages' && config.key !== 'active_hours' ? `<span class="user-highlight">${value}</span>` : value);
                    
                    statContent.innerHTML = `
                        <div class="stat-type">${config.type}</div>
                        <div class="stat-main">${highlightedValue}</div>
                        <div class="stat-detail">${detail}</div>
                    `;
                }
                
                statContent.classList.remove('loading');
                currentStatIndex = statIndex;
            }, 300);
        }

        function displayError() {
            const statContent = document.getElementById('statContent');
            statContent.innerHTML = `
                <div class="stat-type">æ•°æ®åŠ è½½å¤±è´¥</div>
                <div class="stat-main">ğŸ˜…</div>
                <div class="stat-detail">è¯·ç¨åé‡è¯•</div>
            `;
        }

        async function loadRandomStat() {
            if (!basicStats) {
                const success = await loadBasicStats();
                if (!success) {
                    displayError();
                    return;
                }
            }
            
            const randomIndex = getRandomStatIndex();
            displayStat(randomIndex);
        }

        function drawActivityChart() {
            const canvas = document.getElementById('activityChart');
            if (!canvas || !basicStats?.active_hours?.hourly) return;
            
            const ctx = canvas.getContext('2d');
            const hourlyData = basicStats.active_hours.hourly;
            
            // è®¾ç½®canvaså°ºå¯¸
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * window.devicePixelRatio;
            canvas.height = rect.height * window.devicePixelRatio;
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
            
            const width = rect.width;
            const height = rect.height;
            const padding = 40;
            const chartWidth = width - padding * 2;
            const chartHeight = height - padding * 2;
            
            // æ‰¾åˆ°æœ€å¤§å€¼ç”¨äºç¼©æ”¾
            const maxCount = Math.max(...hourlyData.map(d => d.count));
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);
            
            // ç»˜åˆ¶ç½‘æ ¼çº¿
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            
            // æ°´å¹³ç½‘æ ¼çº¿
            for (let i = 0; i <= 4; i++) {
                const y = padding + (chartHeight / 4) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
            }
            
            // å‚ç›´ç½‘æ ¼çº¿
            for (let i = 0; i <= 6; i++) {
                const x = padding + (chartWidth / 6) * i;
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, height - padding);
                ctx.stroke();
            }
            
            // ç»˜åˆ¶æŠ˜çº¿
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            ctx.beginPath();
            hourlyData.forEach((data, index) => {
                const x = padding + (chartWidth / 23) * index;
                const y = height - padding - (data.count / maxCount) * chartHeight;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();
            
            // ç»˜åˆ¶æ•°æ®ç‚¹
            ctx.fillStyle = '#667eea';
            hourlyData.forEach((data, index) => {
                const x = padding + (chartWidth / 23) * index;
                const y = height - padding - (data.count / maxCount) * chartHeight;
                
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // ç»˜åˆ¶åæ ‡è½´æ ‡ç­¾
             ctx.fillStyle = '#000';
             ctx.font = '12px Arial';
             ctx.textAlign = 'center';
            
            // Xè½´æ ‡ç­¾ï¼ˆæ—¶é—´ï¼‰
            for (let i = 0; i < 24; i += 4) {
                const x = padding + (chartWidth / 23) * i;
                ctx.fillText(`${i}:00`, x, height - 10);
            }
            
            // Yè½´æ ‡ç­¾ï¼ˆæ¶ˆæ¯æ•°ï¼‰
            ctx.textAlign = 'right';
            for (let i = 0; i <= 4; i++) {
                const y = padding + (chartHeight / 4) * i;
                const value = Math.round(maxCount * (4 - i) / 4);
                ctx.fillText(value.toLocaleString(), padding - 10, y + 4);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ˜¾ç¤ºéšæœºç»Ÿè®¡
        document.addEventListener('DOMContentLoaded', loadRandomStat);
        
        // çª—å£å¤§å°æ”¹å˜æ—¶é‡ç»˜å›¾è¡¨
         window.addEventListener('resize', () => {
             if (currentStatIndex >= 0 && statConfigs[currentStatIndex]?.isChart) {
                 setTimeout(() => drawActivityChart(), 100);
             }
         });
    </script>

    <!-- ä¸»é¢˜åˆ‡æ¢ç³»ç»Ÿ -->
    <script src="theme-switcher.js?v=202508272235"></script>
    <script src="theme-selector.js?v=202508272235"></script>

    <!-- Powered by æ ‡è¯† -->
    <div class="powered-by">
        <span>powered by TGW~</span>
    </div>
</body>
</html>