<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人数据分析</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* CSS变量定义 - 统一透明度控制 */
        :root {
            --panel-opacity: 0.55; /* 主要板块透明度 - 增加透明度 */
            --search-opacity: 0.45; /* 搜索框透明度 - 增加透明度 */
            --blur-amount: 15px; /* 背景模糊程度 - 增加模糊度提升毛玻璃效果 */
            --bg-opacity: 0.2; /* 背景图透明度 */
            --glass-border: rgba(255, 255, 255, 0.7); /* 毛玻璃边框颜色 - 更亮的边框 */
            --glass-shadow: 0 12px 40px rgba(0, 0, 0, 0.15), 0 4px 16px rgba(255, 255, 255, 0.1); /* 增强毛玻璃阴影和高光 */
        }
        
        /* 基础样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            /* 多层径向渐变背景 */
            background: 
                radial-gradient(circle at var(--gradient1-x, 20%) var(--gradient1-y, 20%), var(--color-primary) 0%, transparent 50%), 
                radial-gradient(circle at var(--gradient2-x, 80%) var(--gradient2-y, 80%), var(--color-secondary) 0%, transparent 50%), 
                radial-gradient(circle at var(--gradient3-x, 40%) var(--gradient3-y, 60%), var(--color-primary-dark) 0%, transparent 50%), 
                radial-gradient(circle at var(--gradient4-x, 70%) var(--gradient4-y, 30%), var(--color-secondary-dark) 0%, transparent 50%), 
                radial-gradient(circle at var(--gradient5-x, 30%) var(--gradient5-y, 70%), var(--color-accent) 0%, transparent 50%), 
                radial-gradient(circle at var(--gradient6-x, 60%) var(--gradient6-y, 40%), var(--color-accent-dark) 0%, transparent 50%), 
                linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 25%, var(--color-secondary) 50%, var(--color-secondary-dark) 75%, var(--color-accent) 100%);
            background-size: 100% 100%;
        }
        
        /* 倒计时弹窗样式 - 低调版本 */
        .countdown-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--color-bg-overlay);
            backdrop-filter: blur(var(--blur-amount));
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .countdown-modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .countdown-modal-overlay.hide {
            opacity: 0;
            visibility: hidden;
        }
        
        .countdown-modal {
            background: var(--color-bg-primary);
            border-radius: 16px;
            padding: 1.5rem;
            max-width: 320px;
            width: 85%;
            text-align: center;
            box-shadow: var(--glass-shadow);
            backdrop-filter: blur(var(--blur-amount)) saturate(180%);
            border: 1px solid var(--color-border-light);
            transform: translateY(10px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: visible;
        }
        
        .countdown-modal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--color-bg-glass);
            pointer-events: none;
            z-index: 1;
        }
        
        .countdown-modal > * {
            position: relative;
            z-index: 2;
        }
        
        .countdown-modal-overlay.show .countdown-modal {
            transform: translateY(0);
        }
        
        .countdown-header {
            margin-bottom: 1rem;
        }
        
        .countdown-header h3 {
            margin: 0 0 0.8rem 0;
            font-size: 1.2rem;
            color: var(--color-text-primary);
            font-weight: 500;
        }
        
        .countdown-timer {
            display: inline-block;
            width: 40px;
            height: 40px;
            line-height: 40px;
            background: var(--color-bg-glass);
            color: var(--color-text-primary);
            border-radius: 50%;
            font-size: 1.3rem;
            font-weight: 600;
            box-shadow: var(--glass-shadow);
            backdrop-filter: blur(var(--blur-amount));
            border: 1px solid var(--color-border-light);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .countdown-timer:hover {
            transform: scale(1.1);
            background: var(--color-bg-light);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2), var(--glass-shadow);
        }
        
        .countdown-timer:active {
            transform: scale(0.95);
        }
        
        .countdown-content {
            margin: 1rem 0;
            padding: 0.8rem;
            background: var(--color-bg-glass);
            border-radius: 10px;
            border: 1px solid var(--color-border-light);
        }
        
        .tips-icon {
            font-size: 1.3rem;
            margin-bottom: 0.3rem;
            opacity: 0.8;
        }
        
        .tips-text {
            margin: 0;
            font-size: 0.95rem;
            color: var(--color-text-primary);
            line-height: 1.5;
            font-weight: 400;
            opacity: 0.9;
        }
        
        .countdown-footer {
            margin-top: 1rem;
            position: relative;
        }
        
        .skip-btn {
            background: var(--color-bg-glass);
            color: var(--color-text-primary);
            border: 1px solid var(--color-border-light);
            padding: 0.6rem 1.5rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--glass-shadow);
            backdrop-filter: blur(var(--blur-amount));
        }
        
        .skip-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--color-border-light);
            background: var(--color-bg-light);
        }
        
        .skip-btn:active {
            transform: translateY(0);
        }
        
        /* 彩蛋弹窗样式 */
        .easter-egg-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translateX(-50%) translateY(-50%) scale(0.8);
            z-index: 10001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .easter-egg-alert.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-50%) scale(1);
        }
        
        .easter-egg-alert.hide {
            opacity: 0;
            visibility: hidden;
            transform: translateX(-50%) translateY(-50%) scale(0.9);
        }
        
        .easter-egg-content {
            background: var(--color-bg-primary);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            box-shadow: var(--glass-shadow);
            backdrop-filter: blur(var(--blur-amount)) saturate(180%);
            border: 1px solid var(--color-border-light);
            position: relative;
            overflow: hidden;
            max-width: 300px;
            text-align: center;
        }
        
        .easter-egg-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--color-bg-glass);
            pointer-events: none;
            z-index: 1;
        }
        
        .easter-egg-content p {
            margin: 0;
            font-size: 0.95rem;
            color: var(--color-text-primary);
            font-weight: 500;
            position: relative;
            z-index: 2;
            opacity: 0.9;
        }
        
        .side-btn {
            background: var(--color-bg-glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--color-border-light);
            border-radius: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-lg);
            color: var(--color-text-primary);
            font-size: var(--font-size-sm);
            cursor: pointer;
            transition: var(--transition-normal);
            box-shadow: var(--glass-shadow);
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-top: var(--spacing-lg);
            z-index: 1000;
            width: auto;
            white-space: nowrap;
        }
        
        .side-btn:hover {
            background: var(--color-bg-light);
            border-color: var(--color-border-primary);
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 4px 12px var(--color-border-light);
        }

        .side-btn:active {
            background: var(--color-bg-secondary);
            transform: translateX(-50%) translateY(0);
        }

        
        .side-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* 粒子效果层 */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.1) 2px, transparent 2px), 
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.15) 1px, transparent 1px), 
                radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.1) 1.5px, transparent 1.5px),
                radial-gradient(circle at 60% 90%, rgba(255, 255, 255, 0.08) 1px, transparent 1px),
                radial-gradient(circle at 90% 60%, rgba(255, 255, 255, 0.12) 1.5px, transparent 1.5px);
            background-size: 200px 200px, 150px 150px, 180px 180px, 220px 220px, 160px 160px;
            opacity: 0.6;
            z-index: -1;
            animation: particleFloat 14s linear infinite;
        }
        
        /* 额外的光晕效果 */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at var(--glow1-x, 25%) var(--glow1-y, 75%), rgba(255, 255, 255, 0.1) 0%, transparent 30%),
                radial-gradient(circle at var(--glow2-x, 75%) var(--glow2-y, 25%), rgba(255, 255, 255, 0.08) 0%, transparent 25%);
            z-index: -1;
            animation: glowFloat 18s ease-in-out infinite;
        }
        
        @keyframes particleFloat {
            0% { 
                transform: translateY(0px) rotate(0deg);
                opacity: 0.6;
            }
            50% { 
                transform: translateY(-20px) rotate(180deg);
                opacity: 0.8;
            }
            100% { 
                transform: translateY(0px) rotate(360deg);
                opacity: 0.6;
            }
        }
        
        @keyframes glowFloat {
            0% { 
                transform: scale(1) rotate(0deg);
                opacity: 0.3;
            }
            33% { 
                transform: scale(1.1) rotate(120deg);
                opacity: 0.5;
            }
            66% { 
                transform: scale(0.9) rotate(240deg);
                opacity: 0.4;
            }
            100% { 
                transform: scale(1) rotate(360deg);
                opacity: 0.3;
            }
        }
        

        
        /* 容器样式 */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        /* 个人统计页面特殊样式 */
        .user-header {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 50%, var(--color-secondary) 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease-in-out infinite;
            color: white;
            padding: 1.2rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .user-header .nav-content {
            display: block;
            text-align: center;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .group-name {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
            font-weight: normal;
        }
        
        /* 用户选择区域 */
        .user-selector {
            background: rgba(255, 255, 255, var(--search-opacity));
            border-radius: 30px;
            padding: 1.5rem 2rem;
            box-shadow: var(--glass-shadow);
            margin: 1.5rem auto;
            max-width: 500px;
            backdrop-filter: blur(var(--blur-amount)) saturate(180%);
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
            opacity: 1;
            transform: translateY(0);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .user-selector.fade-out {
            opacity: 0;
            transform: translateY(-20px);
            pointer-events: none;
        }
        
        .user-selector::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.2) 0%, 
                rgba(255, 255, 255, 0.1) 50%, 
                rgba(255, 255, 255, 0.25) 100%);
            pointer-events: none;
            z-index: 1;
        }
        
        .user-selector > * {
            position: relative;
            z-index: 2;
        }
        
        .qq-input-container {
            display: flex;
            gap: 1rem;
            justify-content: center;
            align-items: center;
            margin: 0;
            flex-wrap: wrap;
        }
        
        #qq-input {
            padding: var(--spacing-md) var(--spacing-xl);
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: var(--radius-xl);
            font-size: 1rem;
            background: rgba(255, 255, 255, var(--search-opacity));
            backdrop-filter: blur(var(--blur-amount));
            color: var(--color-text-black);
            min-width: 180px;
            transition: var(--transition-normal);
            position: relative;
            z-index: 2;
        }
        
        #qq-input:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.6);
            background: rgba(255, 255, 255, 0.7);
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.2);
            color: var(--color-text-black);
        }
        
        #qq-input::placeholder {
            color: var(--color-text-light);
        }
        
        #search-btn {
            padding: var(--spacing-md) var(--spacing-xl);
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
            color: white;
            border: none;
            border-radius: var(--radius-xl);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-normal);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        
        #search-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.2) 0%, 
                rgba(255, 255, 255, 0.1) 50%, 
                rgba(255, 255, 255, 0.2) 100%);
            pointer-events: none;
            z-index: 1;
        }
        
        #search-btn > * {
            position: relative;
            z-index: 2;
        }
        
        #search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            background: linear-gradient(135deg, #7c8ef0 0%, #8a5cb8 100%);
        }
        
        #search-btn:active {
            transform: translateY(0);
        }
        
        .search-message {
            margin: 0;
            padding: 0;
            border-radius: 15px;
            text-align: center;
            font-weight: 500;
            min-height: 0;
            transition: all 0.3s ease;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
        }
        
        .search-message:not(:empty) {
            margin: 0.8rem 0 0 0;
            padding: 10px 20px;
            min-height: 20px;
            opacity: 1;
            max-height: 100px;
        }
        
        .search-message.success {
            background: var(--color-bg-success);
            color: var(--color-text-success);
            border: 1px solid var(--color-border-success);
        }
        
        .search-message.error {
            background: var(--color-bg-error);
            color: var(--color-text-error);
            border: 1px solid var(--color-border-error);
        }
        
        /* 弹出提示样式 */
        .toast-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            font-size: 13px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .toast-notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast-notification.success {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.9), rgba(56, 142, 60, 0.9));
        }

        .toast-notification.error {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.9), rgba(211, 47, 47, 0.9));
        }

        .toast-notification.info {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.9), rgba(25, 118, 210, 0.9));
        }
        
        .search-message.info {
            background: rgba(33, 150, 243, 0.1);
            color: var(--color-text-link);
            border: 1px solid rgba(33, 150, 243, 0.3);
        }
        
        /* 用户数据展示区域 */
        .user-data {
            opacity: 0;
            transform: translateY(15px);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }
        
        .user-data.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
        
        /* 用户标签展示 */
        .user-tags {
            text-align: center;
            margin: 1rem 0;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transition-delay: 0.1s;
        }
        
        .user-data.active .user-tags {
            opacity: 1;
            transform: translateY(0);
        }
        
        .user-tag {
            display: inline-block;
            font-size: 1.3rem;
            font-weight: bold;
            padding: 1rem 2rem;
            margin: 0.5rem;
            border-radius: 30px;
            color: var(--color-text-primary);
            box-shadow: var(--glass-shadow);
            backdrop-filter: blur(var(--blur-amount)) saturate(180%);
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
        }
        
        .user-tag::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.4) 0%, 
                rgba(255, 255, 255, 0.3) 50%, 
                rgba(255, 255, 255, 0.45) 100%);
            pointer-events: none;
            z-index: 1;
        }
        
        .user-tag > * {
            position: relative;
            z-index: 2;
        }
        
        /* 根据不同角色设置不同背景色 */
        .tag-core {
            background: linear-gradient(135deg, rgba(255, 154, 158, var(--panel-opacity)) 0%, rgba(250, 208, 196, var(--panel-opacity)) 100%);
        }
        
        .tag-active {
            background: linear-gradient(135deg, rgba(161, 196, 253, var(--panel-opacity)) 0%, rgba(194, 233, 251, var(--panel-opacity)) 100%);
        }
        
        .tag-occasional {
            background: linear-gradient(135deg, rgba(212, 252, 121, var(--panel-opacity)) 0%, rgba(150, 230, 161, var(--panel-opacity)) 100%);
        }
        
        .tag-lurker {
            background: linear-gradient(135deg, rgba(246, 211, 101, var(--panel-opacity)) 0%, rgba(253, 160, 133, var(--panel-opacity)) 100%);
        }
        
        .tag-no-data {
            background: linear-gradient(135deg, rgba(150, 150, 150, var(--panel-opacity)) 0%, rgba(180, 180, 180, var(--panel-opacity)) 100%);
        }
        
        /* 用户数据卡片特定样式 */
        .user-summary {
            background: linear-gradient(135deg, 
                rgba(150, 180, 255, var(--panel-opacity)) 0%, 
                rgba(180, 200, 255, var(--panel-opacity)) 25%, 
                rgba(200, 220, 255, var(--panel-opacity)) 50%, 
                rgba(170, 190, 255, var(--panel-opacity)) 75%, 
                rgba(190, 210, 255, var(--panel-opacity)) 100%);
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1rem auto;
            width: 90%;
            max-width: 650px;
            min-width: 300px;
            text-align: center;
            color: var(--color-text-primary);
            box-shadow: var(--glass-shadow);
            backdrop-filter: blur(var(--blur-amount)) saturate(180%);
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transition-delay: 0.2s;
        }
        
        .user-data.active .user-summary {
            opacity: 1;
            transform: translateY(0);
        }
        
        .user-engagement {
            background: linear-gradient(135deg, 
                rgba(160, 200, 255, var(--panel-opacity)) 0%, 
                rgba(180, 220, 255, var(--panel-opacity)) 25%, 
                rgba(200, 240, 255, var(--panel-opacity)) 50%, 
                rgba(180, 230, 250, var(--panel-opacity)) 75%, 
                rgba(170, 210, 255, var(--panel-opacity)) 100%);
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1rem auto;
            width: 90%;
            max-width: 650px;
            min-width: 300px;
            text-align: center;
            color: var(--color-text-primary);
            box-shadow: var(--glass-shadow);
            backdrop-filter: blur(var(--blur-amount)) saturate(180%);
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transition-delay: 0.15s;
        }
        
        .user-data.active .user-engagement {
            opacity: 1;
            transform: translateY(0);
        }

        .user-summary::before,
        .user-engagement::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.35) 0%, 
                rgba(255, 255, 255, 0.25) 50%, 
                rgba(255, 255, 255, 0.4) 100%);
            pointer-events: none;
            z-index: 1;
        }

        .user-summary > *,
        .user-engagement > * {
            position: relative;
            z-index: 2;
        }

        .user-summary h3,
        .user-engagement h3 {
            margin-top: 0;
            font-size: 1.6rem;
            color: var(--color-text-primary);
        }

        .user-summary p,
        .user-engagement p {
            font-size: 1.2rem;
            color: var(--color-text-primary);
            margin: 0.5rem 0;
            line-height: 1.8;
        }
        
        /* 活跃时段和核心互动关系卡片的特殊样式 */
        .card h3 {
            margin-top: 0;
            font-size: 1.6rem;
            color: var(--color-text-primary);
            text-align: center;
        }
        
        .card p {
            font-size: 1.2rem;
            color: var(--color-text-primary);
            margin: 0.5rem 0;
            line-height: 1.8;
            text-align: center;
        }
        
        /* 取消活跃时段和核心互动关系卡片的悬停效果 */
        .card:nth-of-type(3):hover,
        .card:nth-of-type(4):hover {
            transform: none;
            background: var(--theme-card-bg-hover);
            backdrop-filter: var(--card-backdrop-filter);
            box-shadow: var(--card-shadow), 
                        0 0 0 1px rgba(255, 255, 255, var(--glass-border-light)),
                        inset 0 1px 0 rgba(255, 255, 255, 0.6);
            border: var(--card-border);
        }
        
        /* 高亮样式 */
        .highlight-number {
            font-size: 1.1em;
            font-weight: bold;
            color: #fff;
            background: rgba(0,0,0,0.3);
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
            margin: 0 0.2rem;
        }
        
        .highlight-text {
            font-weight: bold;
            color: #fff;
            background: rgba(0,0,0,0.3);
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            margin: 0 0.2rem;
        }
        
        .time-period {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            font-weight: bold;
        }
        
        /* 图标样式 */
        .icon {
            margin-right: 0.5rem;
        }
        
        /* 署名 */
        .footer {
            display: inline-block;
            padding: 8px 16px;
            margin: 20px auto 0;
            font-size: 11px;
            color: #333;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 20px;
            backdrop-filter: blur(12px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2), 0 2px 8px rgba(255, 255, 255, 0.15);
            position: relative;
            overflow: hidden;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }
        
        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.3) 0%, 
                rgba(255, 255, 255, 0.2) 50%, 
                rgba(255, 255, 255, 0.35) 100%);
            pointer-events: none;
            z-index: 1;
        }
        
        .footer-container {
            text-align: center;
        }
        
        .footer > * {
            position: relative;
            z-index: 2;
        }
        
        /* AI分析按钮样式 */
        .ai-analysis-button-container {
            text-align: center;
            margin: 1.2rem 0;
        }
        
        .ai-analysis-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            padding: 1rem 2rem;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            backdrop-filter: blur(15px) saturate(180%);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2), 
                        0 4px 16px rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .ai-analysis-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.2) 0%, 
                rgba(255, 255, 255, 0.1) 50%, 
                rgba(255, 255, 255, 0.25) 100%);
            pointer-events: none;
            z-index: 1;
        }
        
        .ai-analysis-btn > * {
            position: relative;
            z-index: 2;
        }
        
        .ai-analysis-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.25), 
                        0 6px 20px rgba(255, 255, 255, 0.15);
            background: rgba(255, 255, 255, 0.2);
        }
        
        .ai-icon {
            font-size: 1.2rem;
        }
        
        /* 时期选择器 */
        .period-selector {
            margin: 1rem 0 1.5rem 0;
            text-align: center;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transition-delay: 0.05s;
        }
        
        .user-data.active .period-selector {
            opacity: 1;
            transform: translateY(0);
        }
        
        .period-selector-label {
            display: block;
            font-size: 1rem;
            font-weight: 600;
            color: var(--color-text-white);
            margin-bottom: 0.8rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .period-buttons {
            display: flex;
            flex-wrap: nowrap;
            justify-content: flex-start;
            gap: 0.8rem;
            max-width: 800px;
            margin: 0 auto;
            overflow-x: auto;
            padding: 0.5rem 0;
            scroll-behavior: smooth;
        }
        
        .period-buttons::-webkit-scrollbar {
            height: 6px;
        }
        
        .period-buttons::-webkit-scrollbar-track {
            background: var(--color-bg-glass);
            border-radius: 3px;
        }
        
        .period-buttons::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }
        
        .period-buttons::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        .period-btn {
            background: var(--color-bg-glass);
            backdrop-filter: blur(var(--blur-amount)) saturate(180%);
            border: 1px solid var(--color-border-light);
            border-radius: 12px;
            padding: 0.8rem 1.2rem;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--color-text-white);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--glass-shadow);
            outline: none;
            position: relative;
            overflow: hidden;
            white-space: nowrap;
            flex-shrink: 0;
            min-width: fit-content;
        }
        
        .period-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .period-btn:hover::before {
            left: 100%;
        }
        
        .period-btn:hover {
            background: rgba(255, 255, 255, 0.35);
            border-color: var(--color-border-medium);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2), var(--glass-shadow);
        }
        
        .period-btn.active:hover {
            background: linear-gradient(135deg, #7c8ef0 0%, #8a5cb8 100%);
            border: 2px solid #7c8ef0;
            box-shadow: 0 0 0 3px rgba(124, 142, 240, 0.4), 
                        0 12px 40px rgba(102, 126, 234, 0.5), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.4);
            transform: translateY(-4px) scale(1.08);
        }
        
        .period-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 2px solid #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3), 
                        0 8px 32px rgba(102, 126, 234, 0.4), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.3);
            color: var(--color-text-white);
            font-weight: 600;
            transform: translateY(-3px) scale(1.05);
            position: relative;
            z-index: 10;
        }
        
        .period-btn:active {
            transform: translateY(0);
        }
        
        .period-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .period-btn:disabled:hover {
            background: var(--color-bg-glass);
            border-color: var(--color-border-light);
            transform: none;
        }
        
        .period-item-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.2rem;
            display: block;
        }
        
        .period-item-desc {
            font-size: 0.85rem;
            opacity: 0.8;
            line-height: 1.3;
        }
        
        .period-item-date {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 0.2rem;
            font-style: italic;
        }
        
        /* 按钮禁用状态 */
        .period-dropdown-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .period-dropdown-btn:disabled:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            transform: none !important;
            box-shadow: var(--glass-shadow);
        }
        
        .period-select:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .period-select:disabled:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            transform: none;
        }
        
        /* AI分析卡片特定样式 */
        .ai-analysis-card {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1rem auto;
            width: 90%;
            max-width: 650px;
            min-width: 300px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(15px) saturate(180%);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15), 
                        0 4px 16px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeInUp 0.5s ease-out;
        }
        
        .ai-analysis-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(0, 0, 0, 0.02) 0%, 
                rgba(0, 0, 0, 0.01) 50%, 
                rgba(0, 0, 0, 0.03) 100%);
            border-radius: 16px;
            pointer-events: none;
            z-index: 1;
        }
        
        .ai-analysis-card > * {
            position: relative;
            z-index: 2;
        }
        
        .ai-analysis-card h3 {
            color: var(--color-text-primary);
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: bold;
        }
        
        #ai-analysis-content {
            color: var(--color-text-primary);
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 1rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(0, 0, 0, 0.08);
        }
        
        /* Markdown内容样式 */
        #ai-analysis-content h1 {
            color: var(--color-text-primary);
            font-size: 1.8rem;
            margin: 1.5rem 0 1rem 0;
            font-weight: bold;
            text-align: center;
        }
        
        #ai-analysis-content h2 {
            color: var(--color-text-primary);
            font-size: 1.4rem;
            margin: 1.2rem 0 0.8rem 0;
            font-weight: bold;
            border-bottom: 2px solid rgba(0, 0, 0, 0.2);
            padding-bottom: 0.3rem;
        }
        
        #ai-analysis-content h3 {
            color: var(--color-text-secondary);
            font-size: 1.2rem;
            margin: 1rem 0 0.6rem 0;
            font-weight: bold;
        }
        
        #ai-analysis-content p {
            margin: 0.8rem 0;
            text-align: justify;
        }
        
        #ai-analysis-content strong {
            color: var(--color-text-error);
            font-weight: bold;
        }
        
        #ai-analysis-content ul {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }
        
        #ai-analysis-content li {
            margin: 0.5rem 0;
            list-style-type: disc;
        }
        
        #ai-analysis-content blockquote {
            border-left: 4px solid rgba(0, 0, 0, 0.3);
            padding-left: 1rem;
            margin: 1rem 0;
            font-style: italic;
            opacity: 0.9;
        }
        
        /* 打字机光标动画 */
        .typing-cursor {
            color: #fff;
            font-weight: bold;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% {
                opacity: 1;
            }
            51%, 100% {
                opacity: 0;
            }
        }
        
        .back-btn-container {
            text-align: center;
            margin-bottom: 1rem;
        }
        
        .back-btn {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 15px;
            padding: 0.8rem 1.5rem;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            display: inline-block;
            position: relative;
            z-index: 10;
        }
        
        .back-btn:hover {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transform: translateY(-1px);
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* 移动端优化：禁用动画以提升性能 */
        @media (max-width: 768px) {
            /* 禁用所有背景动画 */
            body::before,
            body::after {
                animation: none !important;
                transform: none !important;
            }
            
            /* 禁用header的背景动画 */
            .user-header {
                animation: none !important;
                background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 50%, var(--color-secondary) 100%) !important;
                background-size: 100% 100% !important;
            }
            
            /* 简化移动端的模糊效果 */
            :root {
                --blur-amount: 5px;
            }
            
            /* 卡片在平板设备上的优化 */
            .user-summary,
            .user-engagement,
            .active-periods,
            .core-interactions,
            .ai-analysis-card {
                width: 95%;
                margin: 0.8rem auto;
                padding: 1.2rem;
            }
            
            /* AI分析按钮在平板上的优化 */
            .ai-analysis-btn {
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
            }
            
            /* 时期按钮在平板上的优化 */
            .period-buttons {
                gap: 0.6rem;
            }
            
            .period-btn {
                padding: 0.7rem 1rem;
                font-size: 0.85rem;
            }
        }
        
        /* 更小屏幕的额外优化 */
        @media (max-width: 480px) {
            /* 进一步减少模糊效果 */
            :root {
                --blur-amount: 2px;
            }
            
            /* 减少玻璃效果的复杂度 */
            .user-selector::before,
            .user-summary::before,
            .user-engagement::before,
            .active-periods::before,
            .core-interactions::before,
            .footer::before {
                display: none;
            }
            
            /* 禁用动态背景，使用静态渐变 */
            body {
                background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 25%, var(--color-secondary) 50%, var(--color-secondary-dark) 75%, var(--color-accent) 100%) !important;
                animation: none !important;
            }
            
            body::before,
            body::after {
                display: none !important;
            }
            
            /* 手机端卡片优化 */
            .user-summary,
            .user-engagement,
            .active-periods,
            .core-interactions,
            .ai-analysis-card {
                width: 98%;
                margin: 0.5rem auto;
                padding: 1rem;
                min-width: unset;
            }
            
            /* AI分析按钮在手机上的优化 */
            .ai-analysis-btn {
                padding: 0.7rem 1.2rem;
                font-size: 0.95rem;
                margin: 1rem 0;
            }
            
            /* 时期按钮在手机上的优化 */
            .period-buttons {
                gap: 0.5rem;
                max-width: 100%;
                justify-content: flex-start;
                overflow-x: auto;
                padding: 0.5rem 0;
                -webkit-overflow-scrolling: touch;
            }
            
            .period-btn {
                padding: 0.6rem 0.8rem;
                font-size: 0.8rem;
                min-width: auto;
                width: auto;
                flex: none;
                flex-shrink: 0;
                white-space: nowrap;
                overflow: visible;
                text-overflow: clip;
                max-width: none;
            }
            
            /* 在手机端禁用悬停光效和变换效果 */
            .period-btn::before {
                display: none;
            }
            
            .period-btn:hover {
                transform: none;
                box-shadow: var(--glass-shadow);
            }
            
            .period-btn.active:hover {
                transform: translateY(-1px) scale(1.02);
                box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.3), 
                            0 4px 16px rgba(102, 126, 234, 0.3), 
                            inset 0 1px 0 rgba(255, 255, 255, 0.3);
            }
            
            .period-selector-label {
                font-size: 0.9rem;
                margin-bottom: 0.6rem;
            }
            
            .ai-analysis-card h3 {
                font-size: 1.3rem;
            }
            
            #ai-analysis-content {
                font-size: 1rem;
                line-height: 1.6;
            }
            
            /* 手机端字体调整 */
            .user-summary h3,
            .user-engagement h3,
            .active-periods h3,
            .core-interactions h3 {
                font-size: 1.4rem;
            }
            
            .user-summary p,
            .user-engagement p,
            .active-periods p,
            .core-interactions p {
                font-size: 1.1rem;
                line-height: 1.6;
            }
        }
        
        /* 访问限制页面样式 */
        .access-restriction {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 25%, var(--color-secondary) 50%, var(--color-secondary-dark) 75%, var(--color-accent) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10001;
        }
        
        .restriction-content {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.9) 0%, 
                rgba(240, 248, 255, 0.9) 50%, 
                rgba(255, 255, 255, 0.9) 100%);
            border-radius: 20px;
            padding: 3rem 2rem;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2), 0 8px 24px rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.8);
            animation: restrictionFadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes restrictionFadeIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .restriction-title {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--color-text-secondary);
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .restriction-message {
            font-size: 1.2rem;
            color: var(--color-text-muted);
            margin-bottom: 2rem;
            line-height: 1.6;
        }
        
        .countdown-container {
            background: rgba(255, 255, 255, 0.6);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 2rem 0;
            border: 1px solid rgba(255, 255, 255, 0.8);
        }
        
        .countdown-label {
            font-size: 1rem;
            color: #718096;
            margin-bottom: 1rem;
            font-weight: 500;
        }
        
        .countdown-display {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--color-primary);
            font-family: 'Courier New', monospace;
            text-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);
        }
        
        .restriction-footer {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.6);
        }
        
        .restriction-note {
            font-size: 0.95rem;
            color: var(--color-text-light);
            font-style: italic;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .restriction-content {
                padding: 2rem 1.5rem;
                margin: 1rem;
            }
            
            .restriction-title {
                font-size: 1.8rem;
            }
            
            .restriction-message {
                font-size: 1.1rem;
            }
            
            .countdown-display {
                font-size: 1.5rem;
            }
        }
    </style>
    <!-- Markdown解析库 - 本地版本 -->
    <script src="./marked.min.js"></script>
</head>
<body>
    <header class="user-header">
        <div class="nav-content">
            <div style="position: absolute; top: 20px; left: 20px;">
                <button onclick="window.location.href='index.html'; event.stopPropagation();" class="back-button">◀</button>
            </div>
            <div style="text-align: center;">
                <div class="group-name" id="group-name"></div>
                <h1 style="font-size: 1.6rem; margin: 0.5rem 0;" id="main-title">个人数据分析</h1>
                <p style="margin: 0; opacity: 0.8;" id="subtitle"></p>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- QQ号输入区域 -->
        <div class="user-selector">
            <div class="qq-input-container">
                <input type="text" id="qq-input" placeholder="请输入你的QQ号" maxlength="15">
                <button id="search-btn">查看数据</button>
            </div>
            <div id="search-message" class="search-message"></div>
        </div>
        
        <!-- 用户数据展示区域 -->
        <div class="user-data" id="user-data">
            <!-- 返回按钮 - 独立放置在卡片上方 -->
            <div class="back-btn-container" id="back-btn-container" style="display: none;">
                <button class="back-btn" onclick="toggleAIAnalysis()">返回数据分析</button>
            </div>
            
            <!-- AI分析卡片 - 置顶 -->
            <div class="card ai-analysis-card" id="ai-analysis-card" style="display: none;">
                <h3>AI个人分析报告</h3>
                <div id="ai-analysis-content"></div>
            </div>
            
            <!-- 时期选择器 -->
            <div class="period-selector" id="period-selector">
                <label class="period-selector-label">选择数据时期</label>
                <div class="period-buttons" id="period-buttons">
                    <!-- 动态生成的时期按钮 -->
                </div>
            </div>
            
            <!-- 用户标签展示 -->
            <div class="user-tags">
                <div class="user-tag" id="user-tag"></div>
            </div>
            
            <!-- 用户统计摘要 -->
            <div class="card user-summary">
                <h3><span class="icon"></span>你的群聊足迹</h3>
                <p id="user-summary-text"></p>
            </div>
            
            <!-- 用户参与度 -->
            <div class="card user-engagement">
                <h3><span class="icon"></span>你的群聊参与度</h3>
                <p id="user-engagement-text"></p>
            </div>
            
            <!-- 活跃时段 -->
            <div class="card active-periods-card">
                <h3>你的活跃时段</h3>
                <p id="active-periods-text"></p>
            </div>
            
            <!-- 核心互动关系 -->
            <div class="card core-interactions-card">
                <h3>你的核心互动关系</h3>
                <p id="core-interactions-text"></p>
            </div>
            
            <!-- AI分析按钮 -->
            <div class="ai-analysis-button-container">
                <button class="ai-analysis-btn" id="ai-analysis-btn" onclick="toggleAIAnalysis()">
                    AI个人分析
                </button>
            </div>
            

        </div>
    </main>
    
    <!-- 署名 -->
    <div class="footer-container">
        <div class="powered-by">
            <span>powered by TGW~<br>（感谢苏辰提供的聊天记录~）</span>
        </div>
    </div>
    
    <script>
        // 访问控制配置
        const ACCESS_CONFIG = {
            // 是否启用访问时间限制
            enableTimeRestriction: true,
            // 允许访问的星期几 (0=周日, 1=周一, ..., 6=周六)
            allowedDays: [0, 6], // 周日和周六
            // 自定义限制消息
            restrictionMessage: '该页面在周六和周日开放',
            // 是否显示倒计时到下次可访问时间
            showCountdown: false
        };
        
        // 全局变量
        let userData = null;
        let periodsData = null;        // 时期配置数据
        let currentPeriodId = '1_all';  // 当前选中的时期ID
        let currentUserHash = null;     // 当前用户哈希值
        
        // 访问控制函数
        function checkAccessPermission() {
            if (!ACCESS_CONFIG.enableTimeRestriction) {
                return { allowed: true };
            }
            
            const now = new Date();
            const currentDay = now.getDay(); // 0=周日, 1=周一, ..., 6=周六
            
            if (ACCESS_CONFIG.allowedDays.includes(currentDay)) {
                return { allowed: true };
            }
            
            // 计算下次可访问时间
            let nextAccessTime = null;
            if (ACCESS_CONFIG.showCountdown) {
                const daysUntilWeekend = getNextWeekendDays(currentDay);
                nextAccessTime = new Date(now);
                nextAccessTime.setDate(now.getDate() + daysUntilWeekend);
                nextAccessTime.setHours(0, 0, 0, 0);
            }
            
            return {
                allowed: false,
                message: ACCESS_CONFIG.restrictionMessage,
                nextAccessTime: nextAccessTime
            };
        }
        
        function getNextWeekendDays(currentDay) {
            // 计算距离下个周六的天数
            if (currentDay === 0) return 6; // 周日到周六
            if (currentDay <= 6) return 6 - currentDay; // 周一到周五到周六
            return 0;
        }
        
        function showAccessRestriction(accessResult) {
            // 隐藏主要内容
            const mainContent = document.querySelector('.container');
            if (mainContent) {
                mainContent.style.display = 'none';
            }
            
            // 创建限制访问页面
            const restrictionHTML = `
                <html>
                <head>
                    <title>访问受限</title>
                </head>
                <body style="margin:0;padding:20px;font-family:Arial,sans-serif;background:var(--color-bg-white);color:var(--color-text-dark);">
                    <h1>访问受限</h1>
                    <p>${accessResult.message}</p>
                </body>
                </html>
            `;
            
            // 替换整个页面内容
            document.open();
            document.write(restrictionHTML);
            document.close();
            return; // 阻止后续代码执行
            
            // 如果需要显示倒计时，启动倒计时功能
            if (accessResult.nextAccessTime && ACCESS_CONFIG.showCountdown) {
                startAccessCountdown(accessResult.nextAccessTime);
            }
        }
        
        function startAccessCountdown(targetTime) {
            const countdownElement = document.getElementById('access-countdown');
            if (!countdownElement) return;
            
            function updateCountdown() {
                const now = new Date();
                const timeDiff = targetTime - now;
                
                if (timeDiff <= 0) {
                    countdownElement.textContent = '现在可以访问了！';
                    // 可以选择自动刷新页面
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                    return;
                }
                
                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
                
                let countdownText = '';
                if (days > 0) countdownText += `${days}天 `;
                if (hours > 0) countdownText += `${hours}小时 `;
                if (minutes > 0) countdownText += `${minutes}分钟 `;
                countdownText += `${seconds}秒`;
                
                countdownElement.textContent = countdownText;
            }
            
            updateCountdown();
            setInterval(updateCountdown, 1000);
        }
        
        // 动态背景控制
        const gradientColors = [
            {
                name: '蓝紫色',
                xVar: '--gradient1-x',
                yVar: '--gradient1-y',
                color: '#667eea',
                currentX: 20,
                currentY: 20,
                targetX: 20,
                targetY: 20,
                speedX: 0,
                speedY: 0
            },
            {
                name: '粉紫色',
                xVar: '--gradient2-x',
                yVar: '--gradient2-y',
                color: '#f093fb',
                currentX: 80,
                currentY: 80,
                targetX: 80,
                targetY: 80,
                speedX: 0,
                speedY: 0
            },
            {
                name: '深紫色',
                xVar: '--gradient3-x',
                yVar: '--gradient3-y',
                color: '#764ba2',
                currentX: 40,
                currentY: 60,
                targetX: 40,
                targetY: 60,
                speedX: 0,
                speedY: 0
            },
            {
                name: '红粉色',
                xVar: '--gradient4-x',
                yVar: '--gradient4-y',
                color: '#f5576c',
                currentX: 70,
                currentY: 30,
                targetX: 70,
                targetY: 30,
                speedX: 0,
                speedY: 0
            },
            {
                name: '蓝色',
                xVar: '--gradient5-x',
                yVar: '--gradient5-y',
                color: '#4facfe',
                currentX: 30,
                currentY: 70,
                targetX: 30,
                targetY: 70,
                speedX: 0,
                speedY: 0
            },
            {
                name: '青色',
                xVar: '--gradient6-x',
                yVar: '--gradient6-y',
                color: '#00f2fe',
                currentX: 60,
                currentY: 40,
                targetX: 60,
                targetY: 40,
                speedX: 0,
                speedY: 0
            }
        ];
        
        // 光晕效果控制
        const glowEffects = [
            {
                xVar: '--glow1-x',
                yVar: '--glow1-y',
                currentX: 25,
                currentY: 75,
                targetX: 25,
                targetY: 75,
                speedX: 0,
                speedY: 0
            },
            {
                xVar: '--glow2-x',
                yVar: '--glow2-y',
                currentX: 75,
                currentY: 25,
                targetX: 75,
                targetY: 25,
                speedX: 0,
                speedY: 0
            }
        ];
        
        // 性能检测
        function isLowPerformanceDevice() {
            // 检测移动设备
            if (window.innerWidth <= 768 || /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                return true;
            }
            
            // 检测设备性能
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            
            if (!gl) return true;
            
            const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
            if (debugInfo) {
                const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
                // 检测低端GPU
                if (renderer.includes('Intel') && !renderer.includes('Iris')) {
                    return true;
                }
            }
            
            // 检测内存
            if (navigator.deviceMemory && navigator.deviceMemory < 4) {
                return true;
            }
            
            // 检测CPU核心数
            if (navigator.hardwareConcurrency && navigator.hardwareConcurrency < 4) {
                return true;
            }
            
            return false;
        }
        
        // 初始化动态背景
        function initRandomGradients() {
            if (isLowPerformanceDevice()) {
                console.log('检测到低性能设备，禁用复杂动画');
                return;
            }
            
            const root = document.documentElement;
            
            // 生成新的目标位置
            function generateNewTargets() {
                gradientColors.forEach(gradient => {
                    // 生成15%-85%范围内的随机位置
                    gradient.targetX = Math.random() * 70 + 15;
                    gradient.targetY = Math.random() * 70 + 15;
                    
                    // 计算移动速度（2-5秒内到达目标）
                    const moveTime = Math.random() * 3 + 2; // 2-5秒
                    const totalFrames = moveTime * 60; // 60FPS
                    
                    gradient.speedX = (gradient.targetX - gradient.currentX) / totalFrames;
                    gradient.speedY = (gradient.targetY - gradient.currentY) / totalFrames;
                });
                
                glowEffects.forEach(glow => {
                    glow.targetX = Math.random() * 60 + 20;
                    glow.targetY = Math.random() * 60 + 20;
                    
                    const moveTime = Math.random() * 4 + 3; // 3-7秒
                    const totalFrames = moveTime * 60;
                    
                    glow.speedX = (glow.targetX - glow.currentX) / totalFrames;
                    glow.speedY = (glow.targetY - glow.currentY) / totalFrames;
                });
            }
            
            // 动画循环
            function animateGradients() {
                let allReachedTarget = true;
                
                gradientColors.forEach(gradient => {
                    const distanceX = Math.abs(gradient.targetX - gradient.currentX);
                    const distanceY = Math.abs(gradient.targetY - gradient.currentY);
                    
                    if (distanceX > 0.5 || distanceY > 0.5) {
                        gradient.currentX += gradient.speedX;
                        gradient.currentY += gradient.speedY;
                        allReachedTarget = false;
                    } else {
                        gradient.currentX = gradient.targetX;
                        gradient.currentY = gradient.targetY;
                    }
                    
                    root.style.setProperty(gradient.xVar, gradient.currentX + '%');
                    root.style.setProperty(gradient.yVar, gradient.currentY + '%');
                });
                
                glowEffects.forEach(glow => {
                    const distanceX = Math.abs(glow.targetX - glow.currentX);
                    const distanceY = Math.abs(glow.targetY - glow.currentY);
                    
                    if (distanceX > 0.5 || distanceY > 0.5) {
                        glow.currentX += glow.speedX;
                        glow.currentY += glow.speedY;
                        allReachedTarget = false;
                    } else {
                        glow.currentX = glow.targetX;
                        glow.currentY = glow.targetY;
                    }
                    
                    root.style.setProperty(glow.xVar, glow.currentX + '%');
                    root.style.setProperty(glow.yVar, glow.currentY + '%');
                });
                
                // 如果所有渐变都到达目标，生成新目标
                if (allReachedTarget) {
                    setTimeout(generateNewTargets, Math.random() * 2000 + 1000); // 1-3秒后生成新目标
                }
                
                requestAnimationFrame(animateGradients);
            }
            
            // 开始动画
            generateNewTargets();
            animateGradients();
        }
        
        // SHA-256哈希计算函数
        async function calculateQQHash(qq) {
            // 检查crypto.subtle是否可用
            if (!window.crypto || !window.crypto.subtle) {
                throw new Error('Web Crypto API不可用，请使用HTTPS访问或更新浏览器');
            }
            
            try {
                const saltedQQ = qq + 'qqchat_privacy_protection_2025';
                const encoder = new TextEncoder();
                const data = encoder.encode(saltedQQ);
                const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                return hashHex.substring(0, 16); // 取前16位
            } catch (error) {
                console.error('哈希计算失败:', error);
                throw new Error('哈希计算失败，请重试');
            }
        }
        
        // 初始化搜索功能
        function initializeSearch() {
            const qqInput = document.getElementById('qq-input');
            const searchBtn = document.getElementById('search-btn');
            const searchMessage = document.getElementById('search-message');
            
            // 搜索按钮点击事件
            searchBtn.addEventListener('click', handleSearch);
            
            // 回车键搜索
            qqInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleSearch();
                }
            });
            
            // 输入验证
            qqInput.addEventListener('input', function(e) {
                // 只允许输入数字
                e.target.value = e.target.value.replace(/[^0-9]/g, '');
                // 清除之前的消息
                searchMessage.textContent = '';
                searchMessage.className = 'search-message';
            });
        }
        
        // 处理搜索
        async function handleSearch() {
            const qqInput = document.getElementById('qq-input');
            const searchMessage = document.getElementById('search-message');
            const qq = qqInput.value.trim();
            
            // 验证QQ号
            if (!qq) {
                showMessage('请输入QQ号', 'error');
                return;
            }
            
            if (qq.length < 5 || qq.length > 12) {
                showMessage('QQ号长度应在5-12位之间', 'error');
                return;
            }
            
            try {
                showMessage('正在查找数据...', 'info');
                
                // 计算哈希值
                const hash = await calculateQQHash(qq);
                
                // 查找用户数据
                const userInfo = userData.user_data[hash];
                if (userInfo) {
                    showMessage('数据加载成功！', 'success');
                    
                    // 为用户选择器添加淡出动画
                    const userSelector = document.querySelector('.user-selector');
                    userSelector.classList.add('fade-out');
                    
                    // 等待动画完成后隐藏元素并显示用户数据
                    setTimeout(() => {
                        userSelector.style.display = 'none';
                        // 减少header的下边距，消除多余空白
                        document.querySelector('.user-header').style.marginBottom = '0.5rem';
                        // 显示用户数据区域
                        displayUserData(userInfo, hash);
                        document.getElementById('user-data').classList.add('active');
                    }, 300); // 与CSS动画时间一致
                } else {
                    showMessage('暂未查到有效信息，可能你最近没有发言记录哦', 'error');
                }
            } catch (error) {
                console.error('搜索失败:', error);
                
                // 根据错误类型显示不同的错误信息
                if (error.message.includes('Web Crypto API不可用')) {
                    showMessage('浏览器不支持加密功能，请使用HTTPS访问或更新浏览器', 'error');
                } else if (error.message.includes('哈希计算失败')) {
                    showMessage('数据处理失败，请重试', 'error');
                } else {
                    showMessage('搜索过程中出现错误，请重试', 'error');
                }
            }
        }
        
        // 显示消息
        function showMessage(message, type) {
            // 如果是成功消息或正在查找数据消息，使用弹出提示
            if (type === 'success' || message.includes('数据加载成功') || message.includes('正在查找数据')) {
                const toastType = message.includes('正在查找数据') ? 'info' : 'success';
                const duration = message.includes('正在查找数据') ? 2000 : 3000; // 查找数据提示显示时间稍短
                showToast(message, toastType, duration);
                return;
            }
            
            // 其他消息仍使用原有方式
            const searchMessage = document.getElementById('search-message');
            searchMessage.textContent = message;
            searchMessage.className = `search-message ${type}`;
        }

        function showToast(message, type = 'info', duration = 3000) {
            // 创建弹出提示元素
            const toast = document.createElement('div');
            toast.className = `toast-notification ${type}`;
            toast.textContent = message;
            
            // 添加到页面
            document.body.appendChild(toast);
            
            // 触发显示动画
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            // 自动消失
            setTimeout(() => {
                toast.classList.remove('show');
                // 动画结束后移除元素
                setTimeout(() => {
                    if (toast.parentNode) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, duration);
        }
        
        // 加载数据
        async function loadData(periodFolder = '1_all') {
            try {
                const dataPath = `assets/data/${periodFolder}/data.json`;
                // 添加时间戳参数防止浏览器缓存
                const cacheBuster = `?t=${Date.now()}`;
                const response = await fetch(dataPath + cacheBuster);
                userData = await response.json();
                
                // 设置页面标题
                if (userData.group_info && userData.group_info.name) {
                    document.title = userData.group_info.name;
                    // 同时更新页面顶部显示的主标题
                    document.getElementById('main-title').textContent = userData.group_info.name;
                }
                
            } catch (error) {
                console.error('加载数据失败:', error);
                showMessage(`数据加载失败，请检查${periodFolder}时期的数据文件`, 'error');
            }
        }
        
        // 显示倒计时弹窗
        async function showCountdownModal() {
            return new Promise((resolve) => {
                // TIPS数组
                const tips = [
                    '为什么要展示tips？',
                    '如果不想等，可以试试点击"跳过"，或许有用',
                    '你正在阅读一条tips',
                    '真正的跳过按钮在哪呢',
                    '筹码的底层逻辑：选两个流派，第三个不再出现',
                    '有时不要过早买筹码',
                    '金手电的攻击会向上取整',
                    '喷灌和箭袋一起用？代码说不行',
                    '紫风扇抽牌是真随机',
                    '海王鲨的buff给攻击最低的，包括小偷',
                    '龙宫boss半血召唤三精英',
                    '商店固定两效果一战斗',
                    '出牌上限为⑨',
                    '哈基米从左往右丢牌',
                    '照的技能向上取整',
                    '修女受伤-0也掉被动'
                ];
                
                // 使用真正均匀分布的随机算法选择TIPS
                // 使用加密安全的随机数生成器确保真正的均匀分布
                let randomIndex;
                if (window.crypto && window.crypto.getRandomValues) {
                    // 使用加密安全的随机数生成器
                    const array = new Uint32Array(1);
                    window.crypto.getRandomValues(array);
                    randomIndex = array[0] % tips.length;
                } else {
                    // 降级到改进的Math.random()
                    // 使用单一随机源确保均匀分布
                    randomIndex = Math.floor(Math.random() * tips.length);
                }
                const randomTip = tips[randomIndex];
                
                // 创建弹窗HTML
                const modalHTML = `
                    <div class="countdown-modal-overlay" id="countdown-modal">
                        <div class="countdown-modal">
                            <div class="countdown-header">
                                <h3>数据切换中...</h3>
                                <div class="countdown-timer" id="countdown-timer">2</div>
                            </div>
                            <div class="countdown-content">
                                <div class="tips-icon">tip</div>
                                <p class="tips-text">${randomTip}</p>
                            </div>
                            <div class="countdown-footer">
                                <button class="skip-btn" id="skip-btn">跳过</button>
                            </div>
                        </div>
                    </div>
                `;
                
                // 添加到页面
                document.body.insertAdjacentHTML('beforeend', modalHTML);
                
                const modal = document.getElementById('countdown-modal');
                const timer = document.getElementById('countdown-timer');
                const skipBtn = document.getElementById('skip-btn');
                
                let countdown = 2;
                let isSkipped = false;
                let skipClickCount = 0;
                
                // 显示弹窗
                setTimeout(() => {
                    modal.classList.add('show');
                }, 10);
                
                // 倒计时逻辑
                const countdownInterval = setInterval(() => {
                    countdown--;
                    timer.textContent = countdown;
                    
                    if (countdown <= 0) {
                        clearInterval(countdownInterval);
                        closeModal(false);
                    }
                }, 1000);
                
                // 倒计时数字点击事件 - 直接跳过
                timer.addEventListener('click', () => {
                    clearInterval(countdownInterval);
                    closeModal(true);
                });
                
                // 跳过按钮事件（彩蛋逻辑）
                skipBtn.addEventListener('click', () => {
                    if (skipBtn.disabled) return;
                    
                    skipClickCount++;
                    
                    // 禁用按钮1.5秒
                    skipBtn.disabled = true;
                    skipBtn.style.opacity = '0.5';
                    skipBtn.style.cursor = 'not-allowed';
                    
                    // 增加等待时间
                    countdown += 3;
                    timer.textContent = countdown;
                    
                    if (skipClickCount === 1) {
                        // 首次点击
                        showEasterEggAlert('欸？这一会儿都等不了吗？');
                        
                        setTimeout(() => {
                            skipBtn.disabled = false;
                            skipBtn.style.opacity = '1';
                            skipBtn.style.cursor = 'pointer';
                            skipBtn.textContent = '跳过（没用的）';
                        }, 1500);
                    } else if (skipClickCount === 2) {
                        // 第二次点击
                        showEasterEggAlert('说了没用就是没用呢');
                        
                        setTimeout(() => {
                            skipBtn.disabled = false;
                            skipBtn.style.opacity = '1';
                            skipBtn.style.cursor = 'pointer';
                            skipBtn.textContent = '不跳过';
                        }, 1500);
                    } else if (skipClickCount === 3) {
                        // 第三次点击
                        showEasterEggAlert('这可是你选的，那再多陪我等几秒');
                        
                        setTimeout(() => {
                            skipBtn.disabled = false;
                            skipBtn.style.opacity = '1';
                            skipBtn.style.cursor = 'pointer';
                            skipBtn.textContent = '  '; // 两个空格
                        }, 1500);
                    } else if (skipClickCount === 4) {
                        // 第四次点击
                        showEasterEggAlert('按钮为空');
                        
                        setTimeout(() => {
                            skipBtn.disabled = false;
                            skipBtn.style.opacity = '1';
                            skipBtn.style.cursor = 'pointer';
                            // 按钮文字保持不变（两个空格）
                        }, 1500);
                    } else if (skipClickCount >= 5 && skipClickCount <= 9) {
                        // 第5-9次点击
                        const repeatCount = skipClickCount - 4; // 从第5次开始计算重复次数
                        const message = repeatCount === 1 ? '按钮真的空了，再按也没用' : `按钮真的空了，再按也没用*${repeatCount}`;
                        showEasterEggAlert(message);
                        
                        setTimeout(() => {
                            skipBtn.disabled = false;
                            skipBtn.style.opacity = '1';
                            skipBtn.style.cursor = 'pointer';
                            // 按钮文字保持不变（两个空格）
                        }, 500); // 冷却时间改为0.5秒
                    } else if (skipClickCount === 10) {
                        // 第10次点击
                        const repeatCount = skipClickCount - 4; // 第10次是第6次重复
                        showEasterEggAlert(`按钮真的为空，再按也没用*${repeatCount}`);
                        
                        setTimeout(() => {
                            skipBtn.disabled = false;
                            skipBtn.style.opacity = '1';
                            skipBtn.style.cursor = 'pointer';
                            skipBtn.textContent = '我是笨蛋';
                            
                            // 创建附按钮
                            const sideBtn = document.createElement('button');
                            sideBtn.textContent = '你是笨蛋';
                            sideBtn.className = 'side-btn';
                            sideBtn.id = 'side-btn';
                            
                            // 将附按钮添加到主按钮旁边
                            skipBtn.parentNode.appendChild(sideBtn);
                            
                            // 附按钮点击事件
                            sideBtn.addEventListener('click', () => {
                                if (sideBtn.disabled) return;
                                
                                showEasterEggAlert('我不是！');
                                countdown += 3;
                                timer.textContent = countdown;
                                
                                // 移除附按钮
                                sideBtn.remove();
                                
                                // 主按钮变为"点击启动星趴"
                                skipBtn.textContent = '点击启动星趴';
                            });
                            
                        }, 500); // 冷却时间保持0.5秒
                    } else {
                        // 第11次及以后
                        let cooldownTime = 3000; // 默认冷却时间
                        let addTime = 3; // 默认增加时间
                        let message = '';
                        let newButtonText = '';
                        
                        if (skipBtn.textContent === '我是笨蛋') {
                            // 第11次点击（主按钮为"我是笨蛋"时）
                            const userName = userData && userData.user_data && currentUserHash ? 
                                (userData.user_data[currentUserHash]?.basic_info?.name || '你') : '你';
                            
                            message = `哈哈，${userName}是笨蛋`;
                            addTime = 4.5;
                            newButtonText = '点击启动星趴';
                            
                            // 移除附按钮（如果存在）
                            const sideBtn = document.getElementById('side-btn');
                            if (sideBtn) {
                                sideBtn.remove();
                            }
                        } else if (skipBtn.textContent === '点击启动星趴') {
                            // 第12次点击
                            message = '去群里，帮你@全体成员';
                            addTime = 3;
                            cooldownTime = 1500;
                            newButtonText = '这波能跳过吗？';
                        } else if (skipBtn.textContent === '这波能跳过吗？') {
                            // 第13次点击
                            message = '诶~别急！这波不能跳过！很关键！';
                            addTime = 3;
                            cooldownTime = 1500;
                            newButtonText = '跳过剧情！';
                        } else if (skipBtn.textContent === '跳过剧情！') {
                            // 第14次点击
                            message = '跳过人生！';
                            addTime = 3;
                            cooldownTime = 1500;
                            newButtonText = '……';
                        } else if (skipBtn.textContent === '……' && skipClickCount === 15) {
                            // 第15次点击
                            message = '……';
                            addTime = 3;
                            cooldownTime = 1500;
                            newButtonText = '……'; // 按钮无变化
                        } else if (skipBtn.textContent === '……' && skipClickCount === 16) {
                            // 第16次点击
                            message = '真的没有了';
                            addTime = 3;
                            cooldownTime = 1500;
                            newButtonText = '……'; // 按钮无变化
                        } else if (skipBtn.textContent === '……' && skipClickCount === 17) {
                            // 第17次点击
                            message = '没人会设计这么长的彩蛋的';
                            addTime = 3;
                            cooldownTime = 1500;
                            newButtonText = '……'; // 按钮无变化
                        } else if (skipBtn.textContent === '……' && skipClickCount === 18) {
                            // 第18次点击
                            message = '……';
                            addTime = 3;
                            cooldownTime = 1500;
                            newButtonText = '……'; // 按钮无变化
                        } else if (skipBtn.textContent === '……' && skipClickCount === 19) {
                            // 第19次点击
                            message = '那就点着玩吧';
                            addTime = 3;
                            cooldownTime = 1500;
                            newButtonText = '……'; // 按钮无变化
                        } else if (skipBtn.textContent === '……' && skipClickCount >= 20) {
                            // 第20次及以后点击
                            const clickNumber = skipClickCount - 19; // 从第20次开始计算
                            
                            // 检查是否连续点击了15次（从第20次开始算起）
                            if (clickNumber === 15) {
                                // 连续点击15次，跳转到彩蛋界面
                                message = '恭喜你发现了隐藏界面！';
                                showEasterEggAlert(message);
                                
                                // 延迟跳转到彩蛋界面
                                setTimeout(() => {
                                    window.location.href = 'easter-egg.html';
                                }, 1500);
                                
                                return; // 不再执行后续逻辑
                            }
                            
                            message = `${clickNumber}次`;
                            addTime = 1;
                            cooldownTime = 100; // 0.1秒
                            newButtonText = '……'; // 按钮无变化
                        }
                        
                        showEasterEggAlert(message);
                        countdown += addTime;
                        timer.textContent = Math.ceil(countdown);
                        
                        setTimeout(() => {
                            skipBtn.disabled = false;
                            skipBtn.style.opacity = '1';
                            skipBtn.style.cursor = 'pointer';
                            if (newButtonText) {
                                skipBtn.textContent = newButtonText;
                            }
                        }, cooldownTime);
                    }
                });
                
                // 彩蛋弹窗函数
                function showEasterEggAlert(message) {
                    // 清除所有现有的彩蛋弹窗
                    const existingAlerts = document.querySelectorAll('.easter-egg-alert');
                    existingAlerts.forEach(alert => {
                        if (alert.parentNode) {
                            alert.parentNode.removeChild(alert);
                        }
                    });
                    
                    const alertHTML = `
                        <div class="easter-egg-alert" id="easter-egg-alert-${Date.now()}">
                            <div class="easter-egg-content">
                                <p>${message}</p>
                            </div>
                        </div>
                    `;
                    
                    document.body.insertAdjacentHTML('beforeend', alertHTML);
                    const alert = document.body.lastElementChild;
                    
                    setTimeout(() => {
                        alert.classList.add('show');
                    }, 10);
                    
                    setTimeout(() => {
                        alert.classList.add('hide');
                        setTimeout(() => {
                            if (alert.parentNode) {
                                alert.parentNode.removeChild(alert);
                            }
                        }, 300);
                    }, 2000);
                }
                
                // 关闭弹窗函数
                function closeModal(skipped) {
                    modal.classList.add('hide');
                    setTimeout(() => {
                        if (modal.parentNode) {
                            modal.parentNode.removeChild(modal);
                        }
                        resolve(skipped);
                    }, 300);
                }
            });
        }
        
        // 加载时期配置
        async function loadPeriodsConfig() {
            if (periodsData) {
                return periodsData; // 使用缓存
            }
            
            try {
                // 添加时间戳参数防止浏览器缓存
                const cacheBuster = `?t=${Date.now()}`;
                const response = await fetch('assets/data/periods.json' + cacheBuster);
                periodsData = await response.json();
                console.log(`时期配置加载成功，共${periodsData.periods.length}个时期`);
                
                // 设置默认时期为最后一个时期
                const availablePeriods = periodsData.periods.filter(p => p.status === 'completed' || p.status === 'ongoing');
                if (availablePeriods.length > 0) {
                    // 使用最后一个可用时期作为默认时期
                    const lastPeriod = availablePeriods[availablePeriods.length - 1];
                    currentPeriodId = lastPeriod.id;
                    console.log(`默认时期设置为: ${lastPeriod.name} (${lastPeriod.id})`);
                }
                
                return periodsData;
            } catch (error) {
                console.error('时期配置加载失败:', error);
                // 如果配置加载失败，创建默认配置
                periodsData = {
                    default_period: '1_all',
                    periods: [{
                        id: '1_all',
                        name: '全部数据',
                        description: '包含所有时期的完整数据',
                        folder: '1_all',
                        status: 'active'
                    }]
                };
                return periodsData;
            }
        }
        
        // 时期切换函数
        async function switchPeriod(periodId) {
            if (!currentUserHash || periodId === currentPeriodId) {
                return;
            }
            
            // 获取所有时期按钮和数据容器
            const periodButtons = document.querySelectorAll('.period-btn');
            const userDataContainer = document.querySelector('.user-data');
            
            try {
                // 禁用所有按钮防止重复点击
                periodButtons.forEach(btn => btn.disabled = true);
                
                // 获取时期配置
                const period = periodsData.periods.find(p => p.id === periodId);
                if (!period) {
                    throw new Error('未找到指定时期配置');
                }
                
                // 显示加载状态
                showMessage('正在切换数据时期...', 'info');
                
                // 并行执行：显示倒计时弹窗和加载数据
                const [shouldSkip] = await Promise.all([
                    showCountdownModal(),
                    loadData(period.folder)
                ]);
                
                if (!shouldSkip) {
                    // 添加淡出效果
                    if (userDataContainer) {
                        userDataContainer.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';
                        userDataContainer.style.opacity = '0.3';
                        userDataContainer.style.transform = 'translateY(10px)';
                    }
                    
                    // 等待淡出动画完成
                    await new Promise(resolve => setTimeout(resolve, 150));
                } else {
                    // 跳过动画，直接切换
                    if (userDataContainer) {
                        userDataContainer.style.transition = 'none';
                        userDataContainer.style.opacity = '0.3';
                        userDataContainer.style.transform = 'translateY(10px)';
                    }
                }
                
                // 更新当前时期ID
                currentPeriodId = periodId;
                
                // 更新按钮的选中状态
                periodButtons.forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.periodId === periodId) {
                        btn.classList.add('active');
                    }
                });
                
                // 查找当前用户在新数据中的信息
                const userInfo = userData.user_data[currentUserHash];
                if (!userInfo) {
                    // 即使没有用户数据，也要显示时期切换成功，并显示空数据状态
                    await displayEmptyUserData(period.name);
                    showMessage(`已切换到 ${period.name} 时期，但在此时期未找到你的数据记录`, 'warning');
                } else {
                    // 重新显示用户数据（不包含过渡效果的初始化）
                    await displayUserDataWithTransition(userInfo, currentUserHash);
                    showMessage(`已切换到 ${period.name} 时期`, 'success');
                }
                
            } catch (error) {
                console.error('时期切换失败:', error);
                showMessage('时期切换失败，请重试', 'error');
                
                // 错误时恢复界面状态
                if (userDataContainer) {
                    userDataContainer.style.opacity = '1';
                    userDataContainer.style.transform = 'translateY(0)';
                }
            } finally {
                // 重新启用所有按钮
                const periodButtons = document.querySelectorAll('.period-btn');
                periodButtons.forEach(btn => btn.disabled = false);
            }
        }
        
        // 显示用户数据
        async function displayUserData(data, qq) {
            // 保存当前用户哈希值
            currentUserHash = qq;
            
            // 更新页面标题为用户昵称
            const userName = data.basic_info?.name || '未知用户';
            document.getElementById('main-title').textContent = userName;
            
            // 初始化时期选择器（仅在首次显示时）
            const buttonsContainer = document.getElementById('period-buttons');
            if (!buttonsContainer || buttonsContainer.children.length === 0) {
                await initializePeriodSelector();
            }
            
            // 显示用户标签
            displayUserTag(data);
            
            // 显示用户统计摘要
            displayUserSummary(data);
            
            // 显示用户参与度
            displayUserEngagement(data);
            
            // 显示活跃时段
            displayActivePeriods(data);
            
            // 显示核心互动关系
            displayCoreInteractions(data);
        }
        
        // 显示空数据状态
        async function displayEmptyUserData(periodName) {
            // 清空所有数据显示区域
            document.getElementById('user-tag').textContent = '无数据';
            document.getElementById('user-summary-text').innerHTML = `在 ${periodName} 时期中未找到你的聊天记录<br>可能是因为在此时期内你没有发言或数据未被收录`;
            document.getElementById('user-engagement-text').innerHTML = '暂无参与度数据';
            document.getElementById('active-periods-text').innerHTML = '暂无活跃时段数据';
            document.getElementById('core-interactions-text').innerHTML = '暂无互动关系数据';
            
            // 设置用户标签样式为无数据状态
            const userTag = document.getElementById('user-tag');
            userTag.className = 'user-tag tag-no-data';
            
            // 添加淡入效果
            const userDataContainer = document.querySelector('.user-data');
            if (userDataContainer) {
                // 等待一小段时间确保内容已更新
                await new Promise(resolve => setTimeout(resolve, 50));
                
                // 应用淡入效果
                userDataContainer.style.transition = 'opacity 0.4s ease-in, transform 0.4s ease-in';
                userDataContainer.style.opacity = '1';
                userDataContainer.style.transform = 'translateY(0)';
            }
        }
        
        // 带过渡效果的显示用户数据
        async function displayUserDataWithTransition(data, qq) {
            // 更新数据内容
            await displayUserData(data, qq);
            
            // 添加淡入效果
            const userDataContainer = document.querySelector('.user-data');
            if (userDataContainer) {
                // 等待一小段时间确保内容已更新
                await new Promise(resolve => setTimeout(resolve, 50));
                
                // 应用淡入效果
                userDataContainer.style.transition = 'opacity 0.4s ease-in, transform 0.4s ease-in';
                userDataContainer.style.opacity = '1';
                userDataContainer.style.transform = 'translateY(0)';
            }
        }
        
        // 初始化时期选择器
        async function initializePeriodSelector() {
            try {
                // 加载时期配置
                await loadPeriodsConfig();
                
                // 填充按钮容器
                const buttonsContainer = document.getElementById('period-buttons');
                buttonsContainer.innerHTML = '';
                
                periodsData.periods.forEach(period => {
                    // 显示所有已完成和进行中的时期
                    if (period.status === 'completed' || period.status === 'ongoing') {
                        const button = document.createElement('button');
                        button.className = 'period-btn';
                        button.dataset.periodId = period.id;
                        
                        // 为ongoing状态的时期添加截至日期显示
                        let buttonText = period.name;
                        if (period.status === 'ongoing' && period.end_date) {
                            const endDate = new Date(period.end_date);
                            const month = (endDate.getMonth() + 1).toString().padStart(2, '0');
                            const day = endDate.getDate().toString().padStart(2, '0');
                            buttonText += `（截至${month}/${day}）`;
                        }
                        
                        button.textContent = buttonText;
                        button.title = `${period.description} (${period.start_date} ~ ${period.end_date})`;
                        
                        // 设置当前选中状态
                        if (period.id === currentPeriodId) {
                            button.classList.add('active');
                        }
                        
                        // 添加点击事件
                        button.addEventListener('click', () => {
                            if (period.id !== currentPeriodId) {
                                switchPeriod(period.id);
                            }
                        });
                        
                        buttonsContainer.appendChild(button);
                    }
                });
                
                // 滚动到最右边（最新时期）
                setTimeout(() => {
                    const buttonsContainer = document.getElementById('period-buttons');
                    if (buttonsContainer) {
                        buttonsContainer.scrollLeft = buttonsContainer.scrollWidth;
                    }
                }, 100);
                
            } catch (error) {
                console.error('时期选择器初始化失败:', error);
                // 隐藏时期选择器
                const periodSelector = document.getElementById('period-selector');
                if (periodSelector) {
                    periodSelector.style.display = 'none';
                }
            }
        }
        

        
        // 显示用户标签
        function displayUserTag(data) {
            const userTag = document.getElementById('user-tag');
            const role = data.engagement?.role || '未知';
            
            userTag.textContent = role;
            
            // 根据角色设置不同的样式类
            userTag.className = 'user-tag';
            if (role.includes('核心')) {
                userTag.classList.add('tag-core');
            } else if (role.includes('活跃')) {
                userTag.classList.add('tag-active');
            } else if (role.includes('偶尔')) {
                userTag.classList.add('tag-occasional');
            } else {
                userTag.classList.add('tag-lurker');
            }
        }
        
        // 显示用户统计摘要
        function displayUserSummary(data) {
            const basicInfo = data.basic_info || {};
            const startDate = basicInfo.start_date || '未知';
            const endDate = basicInfo.end_date || '未知';
            const totalDays = basicInfo.total_days || 0;
            const activeDays = basicInfo.active_days || 0;
            const totalMessages = basicInfo.total_messages || 0;
            const messageRank = basicInfo.message_rank || '-';
            
            let summaryText = `你在 <span class="time-period">${startDate}</span> 到<br><span class="time-period">${endDate}</span> 共 <span class="highlight-number">${totalDays}</span> 天内<br>活跃天数为 <span class="highlight-number">${activeDays}</span> 天`;
            
            if (totalDays === activeDays && totalDays > 0) {
                summaryText += '<span class="highlight-text">（全勤！）</span>';
            }
            
            summaryText += `<br><br>共发了 <span class="highlight-number">${totalMessages}</span> 条消息<br>位列全群第 <span class="highlight-number">${messageRank}</span> 名！`;
            
            if (messageRank > 1 && basicInfo.previous_user) {
                const previousUser = basicInfo.previous_user;
                const difference = previousUser.message_count - totalMessages;
                summaryText += `<br><br>与前一名<br>（<span class="highlight-text">${previousUser.name}</span>）<br>相差 <span class="highlight-number">${difference}</span> 条消息！`;
            }
            
            // 添加词语频率统计
            const wordFrequency = data.word_frequency || {};
            if (Object.keys(wordFrequency).length > 0) {
                // 按频率排序，只取频率大于5的词语
                const sortedWords = Object.entries(wordFrequency)
                    .filter(([word, freq]) => freq > 5)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3);
                
                if (sortedWords.length > 0) {
                    summaryText += '<br><br>';
                    
                    // 第一个词语（频率最高）
                    const [firstWord, firstFreq] = sortedWords[0];
                    summaryText += `你的发言里，<span class="highlight-text">${firstWord}</span> 出现频率最高`;
                    
                    // 第二个和第三个词语
                    if (sortedWords.length > 1) {
                        const additionalWords = sortedWords.slice(1).map(([word, freq]) => 
                            `<span class="highlight-text">${word}</span>`
                        ).join(' 和 ');
                        summaryText += `<br>紧接着就是 ${additionalWords}`;
                    }
                    
                    summaryText += '！';
                }
            }
            
            document.getElementById('user-summary-text').innerHTML = summaryText;
        }
        
        // 显示用户参与度
        function displayUserEngagement(data) {
            const engagement = data.engagement || {};
            const engagementScore = engagement.score || 0;
            const engagementRank = engagement.ranking || engagement.rank || 0;
            const role = engagement.role || '未知';
            const interactionScore = engagement.interaction_score || 0;
            const influenceScore = engagement.influence_score || 0;
            
            let rankDisplay = engagementRank || '-';
            
            let interactionText = '';
            if (interactionScore >= 75) {
                interactionText = '尤其喜欢主动与群友互动';
            } else if (interactionScore >= 50) {
                interactionText = '喜欢与群友互动';
            } else if (interactionScore >= 25) {
                interactionText = '有时会主动与群友互动';
            } else {
                interactionText = '不太主动与群友互动';
            }
            
            let engagementText = `相较于其他成员<br>你<span class="highlight-text">${interactionText}</span>`;
            
            let influenceText = '';
            if (influenceScore >= 75) {
                influenceText = '大家在群里都特别留意你呢<br>你在群聊的影响力非常高';
            } else if (influenceScore >= 50) {
                influenceText = '群里不少人记得你呢<br>你在群里的影响力蛮高的';
            } else if (influenceScore >= 25) {
                influenceText = '群里有时会有人留意到你<br>你在群里的影响力不高不低';
            } else {
                influenceText = '你在群里影响力暂时不高呢';
            }
            
            engagementText += `<br><br><span class="highlight-text">${influenceText}</span>`;
            engagementText += `<br><br>总的来看，你在本群参与度得分为：<br><span class="highlight-number">${engagementScore.toFixed(2)}</span>分！位列第<span class="highlight-number">${rankDisplay}</span>名<br>是群聊的<span class="highlight-text">${role}</span>！`;
            
            document.getElementById('user-engagement-text').innerHTML = engagementText;
        }
        
        // 显示活跃时段
        function displayActivePeriods(data) {
            try {
                // 获取高峰时段数据
                const categories = data.basic_info?.active_hours?.categories || {};
                
                // 检查是否为预计算进行时的不完整数据
                if (!data.basic_info?.active_hours || Object.keys(categories).length === 0) {
                    document.getElementById('active-periods-text').innerHTML = '<span class="loading-text">正在分析你的活跃时段...</span>';
                    return;
                }
                
                const sortedCategories = Object.entries(categories)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3);
                
                // 构建高峰时段文本
                let peakTimesText = '';
                if (sortedCategories.length > 0) {
                    const peakTimeNames = sortedCategories.map(item => item[0]);
                    peakTimesText = peakTimeNames.join('、');
                } else {
                    peakTimesText = '暂无数据';
                }
                
                // 获取活跃度得分
                const activityScore = data.engagement?.activity_score || 0;
                
                // 构建活跃时段信息文本
                let activePeriodsText = `你最活跃的三个时间段是：<br><span class="highlight-text">${peakTimesText}</span>`;
                
                // 根据活跃度得分判断是否显示睡眠分析
                if (activityScore >= 40) {
                    const sleepData = data.sleep_patterns;
                    if (sleepData && sleepData.primary_sleep_period) {
                        // 有睡眠数据
                        const primarySleep = sleepData.primary_sleep_period;
                        const startTime = `${primarySleep.start_hour.toString().padStart(2, '0')}:00`;
                        const endTime = `${primarySleep.end_hour.toString().padStart(2, '0')}:00`;
                        
                        activePeriodsText += `<br><br>tg分析了你的发言时间<br>保守估计你一般在<br><span class="highlight-text">${startTime}-${endTime}</span>时睡觉<br>因为此时你的活跃度明显降低<br><br>由此，估计你单次睡眠时长<br>约为<span class="highlight-number">${primarySleep.duration}</span>个小时<br>属于<span class="highlight-text">${sleepData.sleep_type}</span><br>看上去<span class="highlight-text">${sleepData.sleep_quality}</span>呢`;
                    } else if (sleepData && (sleepData.sleep_type === "未知" || !sleepData.primary_sleep_period)) {
                        // 有睡眠数据但无法分析出作息模式
                        activePeriodsText += '<br><br>tg分析了你的发言时间<br>竟然推测不出你的作息！<br>难道你不需要睡觉<br>还是说作息太混乱了？';
                    } else {
                        // 其他情况，无法分析作息
                        activePeriodsText += '<br><br>tg分析了你的发言时间<br>竟然推测不出你的作息！<br>难道你不需要睡觉<br>还是说作息太混乱了？';
                    }
                } else {
                    // 活跃度得分低于40，不显示后续内容
                    activePeriodsText += '<br><br>tg发现你还不够活跃<br>分析不了作息哦';
                }
                
                document.getElementById('active-periods-text').innerHTML = activePeriodsText;
            } catch (error) {
                console.error('生成活跃时段信息时出错:', error);
                document.getElementById('active-periods-text').innerHTML = '生成活跃时段信息时出错';
            }
        }
        
        // 显示核心互动关系
        function displayCoreInteractions(data) {
            const interactions = data.interactions || {};
            
            let coreInteractionsText = '<span style="font-weight: bold; font-size: 1.1rem;">你和谁互动最频繁？</span><br>';
            
            // @ 互动
            if (interactions.mention_targets && interactions.mention_targets.length > 0) {
                const topMention = interactions.mention_targets[0];
                coreInteractionsText += `你 @ 得最多的群友是<br><span class="highlight-text">${topMention.user.name}</span>（${topMention.count}次）`;
            } else {
                coreInteractionsText += '你很少 @ 其他群友';
            }
            
            // 戳一戳互动
            if (interactions.poke_targets && interactions.poke_targets.length > 0) {
                const topPoke = interactions.poke_targets[0];
                coreInteractionsText += `<br>平时被你戳一戳最多的是<br><span class="highlight-text">${topPoke.user.name}</span>（${topPoke.count}次）！`;
            } else {
                coreInteractionsText += '<br>很少戳一戳其他群友！';
            }
            
            coreInteractionsText += '<br><br><span style="font-weight: bold; font-size: 1.1rem;">谁最常与你互动？</span><br>';
            
            // 被 @ 
            if (interactions.mentioned_by && interactions.mentioned_by.length > 0) {
                const topMentionedBy = interactions.mentioned_by[0];
                coreInteractionsText += `<span class="highlight-text">${topMentionedBy.user.name}</span> @ 你的次数最多<br>（${topMentionedBy.count}次）`;
            } else {
                coreInteractionsText += '很少有人 @ 你';
            }
            
            // 被戳一戳
            if (interactions.poked_by && interactions.poked_by.length > 0) {
                const topPokedBy = interactions.poked_by[0];
                coreInteractionsText += `<br><span class="highlight-text">${topPokedBy.user.name}</span> 则最常戳一戳你<br>（${topPokedBy.count}次）~`;
            } else {
                coreInteractionsText += '<br>很少有人戳一戳你~';
            }
            
            // 亲密度分析
            if (interactions.closeness_rankings && interactions.closeness_rankings.length > 0) {
                const topCloseness = interactions.closeness_rankings[0];
                const topScore = Math.round(topCloseness.closeness_index * 100);
                
                if (topScore > 3) {
                    coreInteractionsText += '<br><br><span style="font-weight: bold; font-size: 1.1rem;">亲密度？！</span><br>';
                    coreInteractionsText += `经过多个指标的分析<br>计算出亲密度指数最高的群友是：<br>`;
                    coreInteractionsText += `<div style="text-align: center; margin: 15px 0; font-size: 1.2em; font-weight: bold; color: #fff; background: linear-gradient(135deg, #ff6b6b, #ff8e8e); padding: 10px 20px; border-radius: 25px; box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3); display: inline-block;">${topCloseness.user.name}</div>（${topScore}分）<br>`;
                    
                    if (interactions.bidirectional_check) {
                        if (interactions.bidirectional_check.is_mutual_top) {
                            coreInteractionsText += `（同时，<span class="highlight-text">${topCloseness.user.name}</span><br>亲密度排行榜里的No.1也是你！）<br><br>`;
                        } else {
                            coreInteractionsText += `（不过，对<span class="highlight-text">${topCloseness.user.name}</span>来说<br>亲密度最高的另有其人呢）<br><br>`;
                        }
                    }
                    
                    if (interactions.closeness_rankings.length > 1) {
                        const secondCloseness = interactions.closeness_rankings[1];
                        const secondScore = Math.round(secondCloseness.closeness_index * 100);
                        
                        if (interactions.closeness_rankings.length > 2) {
                            const thirdCloseness = interactions.closeness_rankings[2];
                            const thirdScore = Math.round(thirdCloseness.closeness_index * 100);
                            coreInteractionsText += `其次则是<br><span class="highlight-text">${secondCloseness.user.name}</span>（${secondScore}分）和<br><span class="highlight-text">${thirdCloseness.user.name}</span>（${thirdScore}分）！`;
                        } else {
                            coreInteractionsText += `其次则是<br><span class="highlight-text">${secondCloseness.user.name}</span>（${secondScore}分）！`;
                        }
                    }
                } else {
                    coreInteractionsText += '<br><br><span style="font-weight: bold; font-size: 1.1rem;">亲密度？！</span><br>';
                    coreInteractionsText += `tg分析了你的互动数据<br>发现你与群友的亲密度指数<br>都比较低<br>还需要多多互动哦！`;
                }
            } else {
                coreInteractionsText += '<br><br><span style="font-weight: bold; font-size: 1.1rem;">亲密度？！</span><br>';
                coreInteractionsText += `暂无足够的互动数据<br>来计算亲密度指数`;
            }
            
            document.getElementById('core-interactions-text').innerHTML = coreInteractionsText;
        }
        
        // AI分析功能
        let isAIAnalysisVisible = false;
        let currentTypewriterTimer = null; // 用于跟踪当前的打字机定时器
        
        function toggleAIAnalysis() {
            const userDataCards = document.querySelectorAll('.user-summary, .user-engagement, .card:not(.ai-analysis-card)');
            const userTags = document.querySelector('.user-tags');
            const aiAnalysisCard = document.getElementById('ai-analysis-card');
            const backBtnContainer = document.getElementById('back-btn-container');
            const aiAnalysisBtn = document.getElementById('ai-analysis-btn');
            const periodSelector = document.getElementById('period-selector');
            
            if (!isAIAnalysisVisible) {
                // 显示AI分析卡片和返回按钮，隐藏其他卡片、用户标签和时期选择器
                userDataCards.forEach(card => {
                    card.style.display = 'none';
                });
                if (userTags) {
                    userTags.style.display = 'none';
                }
                if (periodSelector) {
                    periodSelector.style.display = 'none';
                }
                aiAnalysisCard.style.display = 'block';
                backBtnContainer.style.display = 'block';
                aiAnalysisBtn.innerHTML = '返回分析';
                
                // 加载AI分析内容
                loadAIAnalysis();
                isAIAnalysisVisible = true;
            } else {
                // 停止当前的打字机效果
                if (currentTypewriterTimer) {
                    clearInterval(currentTypewriterTimer);
                    currentTypewriterTimer = null;
                }
                
                // 隐藏AI分析卡片和返回按钮
                aiAnalysisCard.style.display = 'none';
                backBtnContainer.style.display = 'none';
                
                // 获取用户数据容器
                const userDataContainer = document.querySelector('.user-data');
                
                // 先移除所有active类，重置动画状态
                if (userDataContainer) {
                    userDataContainer.classList.remove('active');
                }
                userDataCards.forEach(card => {
                    card.classList.remove('active');
                    card.style.display = 'block';
                });
                if (userTags) {
                    userTags.classList.remove('active');
                    userTags.style.display = 'block';
                }
                if (periodSelector) {
                    periodSelector.style.display = 'block';
                }
                
                // 短暂延迟后重新添加active类，触发淡入动画
                setTimeout(() => {
                    if (userDataContainer) {
                        userDataContainer.classList.add('active');
                    }
                    if (userTags) {
                        userTags.classList.add('active');
                    }
                    userDataCards.forEach(card => {
                        card.classList.add('active');
                    });
                }, 50);
                
                aiAnalysisBtn.innerHTML = 'AI个人分析';
                isAIAnalysisVisible = false;
            }
        }
        
        // 统一的打字机效果函数
        function typewriterEffect(element, htmlContent, speed = 10) {
            return new Promise((resolve) => {
                // 停止之前的打字机效果
                if (currentTypewriterTimer) {
                    clearInterval(currentTypewriterTimer);
                    currentTypewriterTimer = null;
                }
                
                // 清空内容并显示光标
                element.innerHTML = '<span class="typing-cursor">|</span>';
                
                // 创建临时元素来解析HTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = htmlContent;
                
                // 提取纯文本内容
                const textContent = tempDiv.textContent || tempDiv.innerText || '';
                
                // 优化的速度和批量大小设置
                const contentLength = textContent.length;
                let batchSize = 1; // 默认逐字显示
                let actualSpeed = speed;
                
                if (contentLength > 200) {
                    // 超长内容：批量显示5个字符，更快速度
                    batchSize = 5;
                    actualSpeed = 5; // 5ms间隔
                } else if (contentLength > 100) {
                    // 长内容：批量显示4个字符
                    batchSize = 4;
                    actualSpeed = 6; // 6ms间隔
                } else if (contentLength > 50) {
                    // 中等内容：批量显示3个字符
                    batchSize = 3;
                    actualSpeed = 7; // 7ms间隔
                } else if (contentLength > 20) {
                    // 较短内容：批量显示2个字符
                    batchSize = 2;
                    actualSpeed = 8; // 8ms间隔
                } else {
                    // 短内容：逐字显示
                    batchSize = 1;
                    actualSpeed = 10; // 10ms间隔
                }
                
                let index = 0;
                currentTypewriterTimer = setInterval(() => {
                    if (index < textContent.length) {
                        // 批量添加字符，保持光标
                        const nextIndex = Math.min(index + batchSize, textContent.length);
                        const currentText = textContent.substring(0, nextIndex);
                        element.innerHTML = currentText + '<span class="typing-cursor">|</span>';
                        index = nextIndex;
                    } else {
                        // 完成后移除光标，显示完整的HTML内容
                        clearInterval(currentTypewriterTimer);
                        currentTypewriterTimer = null;
                        element.innerHTML = htmlContent;
                        resolve();
                    }
                }, actualSpeed);
            });
        }

        // AI分析索引缓存
        let aiAnalysisIndex = null;
        
        // 加载AI分析索引
        async function loadAIAnalysisIndex() {
            if (aiAnalysisIndex) {
                return aiAnalysisIndex; // 使用缓存
            }
            
            try {
                const response = await fetch(`./ai_analysis_index.json?t=${Date.now()}`);
                if (response.ok) {
                    aiAnalysisIndex = await response.json();
                    console.log(`AI分析索引加载成功，共${aiAnalysisIndex.total_count}个分析`);
                    return aiAnalysisIndex;
                }
            } catch (error) {
                console.log('AI分析索引加载失败:', error);
            }
            
            return null;
        }
        
        // 检查是否有AI分析
        function hasAIAnalysis(qqHash) {
            if (!aiAnalysisIndex || !aiAnalysisIndex.analyses) {
                return false;
            }
            
            return aiAnalysisIndex.analyses.some(analysis => analysis.qq_hash === qqHash);
        }

        async function loadAIAnalysis() {
            const qqInput = document.getElementById('qq-input');
            const qq = qqInput.value.trim();
            
            // 先清空内容，不显示任何文字
            document.getElementById('ai-analysis-content').innerHTML = '';
            
            // 等待卡片显示动画完成（约500ms）
            await new Promise(resolve => setTimeout(resolve, 600));
            
            if (!qq) {
                await typewriterEffect(document.getElementById('ai-analysis-content'), '请先输入QQ号查看数据分析');
                return;
            }
            
            // 显示加载状态
            await typewriterEffect(document.getElementById('ai-analysis-content'), 'AI正在分析你的数据...');
            
            try {
                // 先加载AI分析索引
                const index = await loadAIAnalysisIndex();
                
                // 使用相同的加密算法对QQ号进行加密
                const encryptedQQ = await calculateQQHash(qq);
                
                // 检查索引中是否有这个QQ的分析
                if (!index || !hasAIAnalysis(encryptedQQ)) {
                    await typewriterEffect(document.getElementById('ai-analysis-content'), '暂时没有你的AI分析哦');
                    return;
                }
                
                // 如果索引中有，再去加载具体文件
                const fileName = `${encryptedQQ}.json`;
                const response = await fetch(`./ai_analysis/${fileName}?t=${Date.now()}`);
                
                if (!response.ok) {
                    throw new Error('文件不存在');
                }
                
                const data = await response.json();
                if (data.content) {
                    // 获取文件的最后修改时间
                    const lastModified = response.headers.get('Last-Modified');
                    let updateTimeText = '';
                    
                    if (lastModified) {
                        const updateDate = new Date(lastModified);
                        const formattedDate = updateDate.toLocaleDateString('zh-CN', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                        updateTimeText = `<div style="text-align: right; font-size: 0.9rem; color: var(--color-text-secondary); margin-bottom: 1rem; font-style: italic;">更新于 ${formattedDate}</div>`;
                    }
                    
                    // 使用marked库渲染Markdown内容
                    const htmlContent = marked.parse(data.content);
                    // 在内容前添加更新时间，使用打字机效果显示
                    await typewriterEffect(document.getElementById('ai-analysis-content'), updateTimeText + htmlContent);
                } else {
                    await typewriterEffect(document.getElementById('ai-analysis-content'), '暂时没有你的AI分析哦');
                }
            } catch (error) {
                console.log('AI分析加载失败:', error);
                await typewriterEffect(document.getElementById('ai-analysis-content'), '暂时没有你的AI分析哦');
            }
        }
        
        function calculateSimpleHash(str) {
            let hash = 0;
            if (str.length === 0) return hash.toString(16).padStart(16, '0');
            
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // 转换为32位整数
            }
            
            // 转换为16进制并确保长度为16位
            return Math.abs(hash).toString(16).padStart(16, '0');
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', async function() {
            // 首先检查访问权限
            const accessResult = checkAccessPermission();
            if (!accessResult.allowed) {
                showAccessRestriction(accessResult);
                return; // 如果访问受限，直接返回，不执行后续初始化
            }
            
            // 先加载时期配置，确定默认时期
            await loadPeriodsConfig();
            
            // 使用正确的默认时期加载数据
            const defaultPeriod = periodsData.periods.find(p => p.id === currentPeriodId);
            if (defaultPeriod) {
                await loadData(defaultPeriod.folder);
                console.log(`页面初始化使用时期: ${defaultPeriod.name} (${defaultPeriod.id})`);
            } else {
                // 如果没有找到默认时期，使用全部数据
                await loadData();
                console.log('页面初始化使用默认数据: 1_all');
            }
            
            initializeSearch();
            // 只在非低性能设备上初始化动态背景
            if (!isLowPerformanceDevice()) {
                initRandomGradients();
            } else {
                console.log('检测到移动设备或低性能设备，使用静态背景');
            }
        });
    </script>
    
    <!-- 主题切换系统 -->
    <script src="theme-switcher.js?v=202508272235"></script>
    <script src="theme-selector.js?v=202508272235"></script>
</body>
</html>